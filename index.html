<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sohail | Blog</title>

<style>
body{
  margin:0;
  font-family:Segoe UI;
  background:#0f172a;
  color:white;
  text-align:center;
}
.section{padding:60px 20px;}
.card{
  background:#1e293b;
  padding:25px;
  margin:20px auto;
  max-width:600px;
  border-radius:15px;
  text-align:left;
}
button{
  padding:8px 15px;
  margin-top:10px;
  border:none;
  border-radius:15px;
  background:crimson;
  color:white;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="section">
<h1>Hi, I'm Sohail ðŸ‘‹</h1>
<h2>My Posts</h2>
<div id="posts"></div>
</div>

<script type="module">

import { initializeApp } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";

import { getFirestore, collection, getDocs, deleteDoc, doc } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

import { getAuth, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAuKSZXx5xzNppUovxxpo089j4ffsCwEYI",
  authDomain: "website-flux-1.firebaseapp.com",
  projectId: "website-flux-1",
  storageBucket: "website-flux-1.firebasestorage.app",
  messagingSenderId: "130732049094",
  appId: "1:130732049094:web:673a20cb507984a5430dc7"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const ADMIN_EMAIL = "sohail34ks@gmail.com";
let currentUser = null;

onAuthStateChanged(auth,(user)=>{
  currentUser = user;
  loadPosts();
});

async function loadPosts(){
  const postsDiv = document.getElementById("posts");
  postsDiv.innerHTML = "";

  const snapshot = await getDocs(collection(db,"posts"));

  snapshot.forEach((document)=>{
    const data = document.data();
    const postId = document.id;

    const post = document.createElement("div");
    post.className="card";

    post.innerHTML = `
      <h3>${data.title}</h3>
      <p>${data.content}</p>
      ${
        currentUser && currentUser.email===ADMIN_EMAIL
        ? `<button onclick="deletePost('${postId}')">Delete</button>`
        : ""
      }
    `;

    postsDiv.appendChild(post);
  });
}

window.deletePost = async function(id){
  await deleteDoc(doc(db,"posts",id));
  loadPosts();
};

loadPosts();

</script>
</body>
</html>
